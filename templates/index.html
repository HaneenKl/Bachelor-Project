<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Semigroups</title>
    <link rel="stylesheet"
          href="{{ url_for('static', filename='assets/bootstrap/css/bootstrap.min.css') }}">


</head>

<body style="background: var(--bs-light);">
<div class="container-fluid">
    {% if error %}
    <div class="alert alert-danger m-3">
        {{ error }}
    </div>
    {% endif %}
    <div class="d-flex justify-content-end align-items-center p-3 gap-4">

        <button class="btn btn-link fw-bold text-dark text-decoration-none p-0"
                type="button"
                onclick="toggleHistory()">
            History
        </button>

        <a href="/docs"
           class="fw-bold text-decoration-none text-dark"
           target="_blank">
            Documentation
        </a>

    </div>
</div>
<div class="container-fluid" id="historyPanel" style="display: none;">
    <div class="d-flex justify-content-end">
        <div class="card me-3 mb-3" style="width: 420px;">
            <div class="card-body">
                <h5 class="card-title">History</h5>

                {% if history %}
                <ul class="list-group list-group-flush">
                    {% for entry in history %}
                    <li class="list-group-item">
                        <strong>{{ entry.mode }}</strong>:
                        <code>{{ entry.input }}</code>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="mb-0 text-muted">No inputs yet.</p>
                {% endif %}

                <form method="POST" action="/clear_history" class="mt-2">
                    <button class="btn btn-sm btn-outline-secondary {% if not history %}disabled{% endif %}">
                        Clear history
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
<h1 style="text-align: center;font-weight: bold;font-size: 50px;color: var(--bs-dark);">Semigroups</h1>
<div class="row">
    <div class="col">
        <form method="POST" class="m-5" style="border-radius: 10px;">

            <input type="hidden" name="mode" id="modeInput" required>

            <div class="m-5" style="border-radius: 10px;">
                <div class="dropdown" data-bs-toggle="tooltip" data-bss-tooltip="">
                    <button class="btn btn-primary dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown"
                            id="selectMenuButton" type="button" style="background: var(--bs-green);font-weight: bold;">
                        choose input type
                    </button>
                    <div class="dropdown-menu" id="selectMenu" style="background: var(--bs-success-bg-subtle);"><a
                            class="dropdown-item" data-bs-toggle="tooltip" data-bss-tooltip="" id="arden" href="#"
                            onclick="setMode('arden','arden expression')">arden
                        expression</a><a class="dropdown-item" data-bs-toggle="tooltip" data-bss-tooltip="" id="regex"
                                         href="#" onclick="setMode('regex','regular expression')">regular expression</a>
                    </div>
                </div>
                <label for="input_field"></label><textarea id="input_field"
                                                           name="user_input"
                                                           class="form-control"
                                                           rows="5"
                                                           oninput="updateComputeButtons()"
                                                           placeholder="enter input ..."
                                                           style="border-radius: 5px;border-width: 1px;">{{ user_input | default('') }}</textarea>
                <div class="form-check">
                    <div class="form-check" id="spaceModeWrapper" style="display: none;">
                        <input class="form-check-input" type="checkbox" id="checkBox" onchange="toggleSpaceMode(this)"
                               data-space-mode="{{ space_mode }}">
                        <input type="hidden" name="space_mode" id="spaceModeInput">
                        <label
                            class="form-check-label"
                            for="checkBox"><span
                            style="color: rgb(0, 0, 0);">treat each letter as a symbol</span>
                    </label>
                    </div>
                </div>

                <div class="d-flex gap-2 mt-3">

                    <button class="btn btn-primary"
                            formaction="/eggbox"
                            id="ebButton"
                            type="submit"
                            disabled>
                        Egg-box diagram
                    </button>

                    <button class="btn btn-primary"
                            formaction="/left_cayley"
                            id="lgButton"
                            type="submit">
                        left Cayley Graph
                    </button>

                    <button class="btn btn-primary"
                            formaction="/right_cayley"
                            id="rgButton"
                            type="submit">
                        right Cayley graph
                    </button>

                    <button class="btn btn-primary"
                            formaction="/equations"
                            id="ceButton"
                            type="submit">
                        check equations
                    </button>

                </div>
            </div>
        </form>
    </div>
    <div class="col"
         id="ardenHint"
         style="position: relative; margin: initial; display: none;">
        <p style="text-align: center;margin: 50px 50px 0;font-weight: bold;font-size: 18px;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            arden equation input format:
        </span>
        </p>
        <p style="margin: 0;text-align: center;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            A = aA + bB + ε
        </span><br>
            <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            B = aA + bB + b
        </span>
        </p>
        <p style="margin: 0;text-align: center;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            One equation per line. Use "ε" or "epsilon" for the empty word.
        </span>
        </p>
    </div>
    <div class="col"
         id="regexHint"
         style="position: relative; margin: initial; display: none;">
        <p style="text-align: center; margin: 50px 50px 0;
              font-weight: bold; font-size: 18px;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            regular expression input format:
        </span>
        </p>

        <p style="margin: 0; text-align: center;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            concatenation: write symbols next to each other (no spaces)
        </span>
        </p>

        <p style="margin: 0; text-align: center;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            union: use <strong>+</strong>
        </span>
        </p>

        <p style="margin: 0; text-align: center;">
        <span style="color: rgb(8, 8, 8); background-color: rgb(255, 255, 255);">
            Kleene star: use <strong>*</strong>
        </span>
        </p>
    </div>
</div>
<div class="col {% if not svg %}invisible{% endif %}" id="eggBoxCol">
    <div class="card">
        <div class="card-body" id="eggBoxCard">
            <h4 class="card-title" style="text-align: center;">EggBox-Diagram</h4>
            {% if svg %}
            {{ svg | safe }}
            {% endif %}
        </div>
    </div>
</div>
<div class="container">
    <div class="row" id="cayleyRow">
        <div class="col-md-6 {% if not left_svg %}d-none{% endif %}">
            <div class="card">
                <div class="card-body" id="leftCayleyCard">
                    <h4 class="card-title" style="text-align: center;">Left Cayley Graph</h4>
                    {% if left_svg %}
                    {{ left_svg | safe }}
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="col-md-6 {% if not right_svg %}d-none{% endif %}">
            <div class="card">
                <div class="card-body" id="rightCayleyCard">
                    <h4 class="card-title" style="text-align: center;">Right Cayley Graph</h4>
                    {% if right_svg %}
                    {{ right_svg | safe }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<div class="col {% if not show_equations %}d-none{% endif %}" id="equationCol">
    <p style="margin: 50px 50px 0;">check if multiple equations hold</p>
    <form method="POST" action="/equations">

        <input type="hidden" name="mode" value="{{ request.form.mode }}">
        <input type="hidden" name="user_input" value="{{ user_input }}">
        <input type="hidden" name="processed_input" value="{{ processed_input }}">
        <input type="hidden" name="space_mode" value="{{ space_mode }}">
        <label for="equationInput"></label><textarea id="equationInput" name="equation"
                                                     style="margin: 5px 25px 25px 50px;"
                                                     placeholder="enter multiple equations here.."> {{ equation or '' }}</textarea>
        <button class="btn btn-primary" id="checkButton" type="submit"
                style="background: var(--bs-green);font-weight: bold;">check
        </button>
    </form>
    {% if equation_result %}
    <div class="card">
        <div class="card-body" id="equationCheckCard">
            <pre class="mb-0">{{ equation_result }}</pre>
        </div>
    </div>
    {% endif %}
</div>

<script>
    function toggleHistory() {
        const panel = document.getElementById("historyPanel");
        panel.style.display = (panel.style.display === "none") ? "block" : "none";
    }
</script>

<script>
    function updateComputeButtons() {
        const mode = document.getElementById("modeInput").value;
        const input = document.getElementById("input_field").value.trim();
        const ebButton = document.getElementById("ebButton");
        const lgButton = document.getElementById("lgButton");
        const rgButton = document.getElementById("rgButton");
        const ceButton = document.getElementById("ceButton");

        ebButton.disabled = !(mode && input);
        lgButton.disabled = !(mode && input);
        rgButton.disabled = !(mode && input);
        ceButton.disabled = !(mode && input);
    }
</script>

<script>
    function setMode(value, label) {
        document.getElementById("modeInput").value = value;
        document.getElementById("selectMenuButton").textContent = label;

        const spaceWrapper = document.getElementById("spaceModeWrapper");
        const ardenHint = document.getElementById("ardenHint");
        const regexHint = document.getElementById("regexHint");

        if (value === "arden") {
            spaceWrapper.style.display = "none";
            document.getElementById("spaceModeInput").value = "off";
            document.getElementById("checkBox").checked = false;
            ardenHint.style.display = "block";
            regexHint.style.display = "none";
        } else if (value === "regex") {
            spaceWrapper.style.display = "block";
            ardenHint.style.display = "none";
            regexHint.style.display = "block";
        }
        updateComputeButtons();
    }
</script>


<script>
    function toggleSpaceMode(cb) {
        document.getElementById("spaceModeInput").value =
            cb.checked ? "on" : "off";
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cb = document.getElementById("checkBox");
        const hidden = document.getElementById("spaceModeInput");

        // server → UI
        cb.checked = (cb.dataset.spaceMode === "on");

        // UI → form
        hidden.value = cb.checked ? "on" : "off";

        cb.addEventListener("change", () => {
            hidden.value = cb.checked ? "on" : "off";
        });
    });
</script>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const savedMode = "{{ last_mode | default('') }}";
        const spaceWrapper = document.getElementById("spaceModeWrapper");
        const ardenHint = document.getElementById("ardenHint");
        const regexHint = document.getElementById("regexHint");

        if (savedMode) {
            if (savedMode === "arden") {
                setMode("arden", "arden expression");
                spaceWrapper.style.display = "none";
                ardenHint.style.display = "block";
                regexHint.style.display = "none";
            } else if (savedMode === "regex") {
                setMode("regex", "regular expression");
                ardenHint.style.display = "none";
                regexHint.style.display = "block";
            }
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        updateComputeButtons();
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='assets/js/bs-init.js') }}"></script>
</body>
</html>
